============================= test session starts =============================
platform win32 -- Python 3.10.11, pytest-8.4.1, pluggy-1.6.0
rootdir: D:\Projects\omnichannel-agentic-commerce\backend
configfile: pytest.ini
plugins: anyio-4.9.0, asyncio-1.3.0, cov-6.2.1
asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 19 items

tests\unit\test_llm_client.py ...FFFF.FFFFFF.FFF.                        [100%]

================================== FAILURES ===================================
__________ test_classify_intent_enabled_when_classifier_first_policy __________
tests\unit\test_llm_client.py:84: in test_classify_intent_enabled_when_classifier_first_policy
    assert prediction is not None
E   assert None is not None
________ test_classify_intent_parses_valid_json_and_clamps_confidence _________
tests\unit\test_llm_client.py:92: in test_classify_intent_parses_valid_json_and_clamps_confidence
    assert prediction is not None
E   assert None is not None
_________ test_classify_intent_rejects_unsupported_or_invalid_payload _________
tests\unit\test_llm_client.py:105: in test_classify_intent_rejects_unsupported_or_invalid_payload
    assert parsed is not None
E   assert None is not None
_______________ test_classify_intent_handles_wrapped_json_text ________________
tests\unit\test_llm_client.py:116: in test_classify_intent_handles_wrapped_json_text
    assert prediction is not None
E   assert None is not None
_______________ test_call_intent_model_rejects_unknown_provider _______________
tests\unit\test_llm_client.py:133: in test_call_intent_model_rejects_unknown_provider
    client._call_intent_model("hello")
E   AttributeError: 'LLMClient' object has no attribute '_call_intent_model'
__________________________ test_openai_call_success ___________________________
tests\unit\test_llm_client.py:156: in test_openai_call_success
    raw = client._call_openai("prompt")
E   AttributeError: 'LLMClient' object has no attribute '_call_openai'
___________________________ test_openai_call_errors ___________________________
tests\unit\test_llm_client.py:166: in test_openai_call_errors
    LLMClient(settings=_base_settings(openrouter_api_key=""))._call_openai("prompt")
E   AttributeError: 'LLMClient' object has no attribute '_call_openai'
___________________ test_anthropic_call_success_and_errors ____________________
tests\unit\test_llm_client.py:196: in test_anthropic_call_success_and_errors
    raw = client._call_anthropic("prompt")
E   AttributeError: 'LLMClient' object has no attribute '_call_anthropic'
________________ test_plan_actions_parses_multi_action_payload ________________
tests\unit\test_llm_client.py:232: in test_plan_actions_parses_multi_action_payload
    assert plan is not None
E   assert None is not None
___________ test_plan_actions_returns_clarification_when_requested ____________
tests\unit\test_llm_client.py:251: in test_plan_actions_returns_clarification_when_requested
    assert plan is not None
E   assert None is not None
_________________ test_plan_actions_sanitizes_unknown_params __________________
tests\unit\test_llm_client.py:287: in test_plan_actions_sanitizes_unknown_params
    assert plan is not None
E   assert None is not None
________________ test_plan_actions_respects_configured_limits _________________
tests\unit\test_llm_client.py:306: in test_plan_actions_respects_configured_limits
    assert plan is not None
E   assert None is not None
___ test_call_action_planner_model_dispatches_and_rejects_unknown_provider ____
tests\unit\test_llm_client.py:315: in test_call_action_planner_model_dispatches_and_rejects_unknown_provider
    assert openai_client._call_action_planner_model("hello").startswith("openai:")
E   AttributeError: 'LLMClient' object has no attribute '_call_action_planner_model'
=========================== short test summary info ===========================
FAILED tests/unit/test_llm_client.py::test_classify_intent_enabled_when_classifier_first_policy
FAILED tests/unit/test_llm_client.py::test_classify_intent_parses_valid_json_and_clamps_confidence
FAILED tests/unit/test_llm_client.py::test_classify_intent_rejects_unsupported_or_invalid_payload
FAILED tests/unit/test_llm_client.py::test_classify_intent_handles_wrapped_json_text
FAILED tests/unit/test_llm_client.py::test_call_intent_model_rejects_unknown_provider
FAILED tests/unit/test_llm_client.py::test_openai_call_success - AttributeErr...
FAILED tests/unit/test_llm_client.py::test_openai_call_errors - AttributeErro...
FAILED tests/unit/test_llm_client.py::test_anthropic_call_success_and_errors
FAILED tests/unit/test_llm_client.py::test_plan_actions_parses_multi_action_payload
FAILED tests/unit/test_llm_client.py::test_plan_actions_returns_clarification_when_requested
FAILED tests/unit/test_llm_client.py::test_plan_actions_sanitizes_unknown_params
FAILED tests/unit/test_llm_client.py::test_plan_actions_respects_configured_limits
FAILED tests/unit/test_llm_client.py::test_call_action_planner_model_dispatches_and_rejects_unknown_provider
======================== 13 failed, 6 passed in 4.31s =========================
