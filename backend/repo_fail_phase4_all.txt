============================= test session starts =============================
platform win32 -- Python 3.10.11, pytest-8.4.1, pluggy-1.6.0 -- C:\Users\kcjai\AppData\Local\Programs\Python\Python310\python.exe
cachedir: .pytest_cache
rootdir: D:\Projects\omnichannel-agentic-commerce\backend
configfile: pytest.ini
plugins: anyio-4.9.0, asyncio-1.3.0, cov-6.2.1
asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 13 items

tests/unit/test_repositories.py::test_cart_repository_roundtrip_in_memory PASSED
tests/unit/test_repositories.py::test_order_repository_roundtrip_and_idempotency PASSED
tests/unit/test_repositories.py::test_memory_repository_roundtrip_in_memory PASSED
tests/unit/test_repositories.py::test_auth_repository_roundtrip_user_and_refresh PASSED
tests/unit/test_repositories.py::test_interaction_repository_roundtrip_in_memory FAILED
tests/unit/test_repositories.py::test_support_repository_roundtrip_open_tickets PASSED
tests/unit/test_repositories.py::test_session_repository_count_cached PASSED
tests/unit/test_repositories.py::test_session_repository_find_latest_for_user PASSED
tests/unit/test_repositories.py::test_session_repository_cleanup_expired_sessions PASSED
tests/unit/test_repositories.py::test_product_and_inventory_repositories_roundtrip PASSED
tests/unit/test_repositories.py::test_notification_repository_roundtrip_in_memory PASSED
tests/unit/test_repositories.py::test_category_repository_roundtrip_in_memory PASSED
tests/unit/test_repositories.py::test_admin_activity_repository_roundtrip_in_memory PASSED

================================== FAILURES ===================================
_______________ test_interaction_repository_roundtrip_in_memory _______________

    def test_interaction_repository_roundtrip_in_memory() -> None:
        store = InMemoryStore()
        mongo_manager, redis_manager = _fake_managers()
        repo = InteractionRepository(
            store=store,
            mongo_manager=mongo_manager,
            redis_manager=redis_manager,
        )
    
        message = {
            "id": "msg_test_1",
            "sessionId": "session_test_5",
            "userId": None,
            "message": "show me shoes",
            "intent": "search_product",
            "agent": "product",
            "response": {"message": "ok", "metadata": {"success": True}},
            "timestamp": store.iso_now(),
        }
        repo.create(message)
    
        recent = repo.recent(session_id="session_test_5", limit=5)
        assert len(recent) == 1
        assert recent[0]["id"] == "msg_test_1"
    
        day = str(message["timestamp"])[:10]
        today = repo.list_by_date(date_prefix=day)
>       assert len(today) == 1
E       assert 0 == 1
E        +  where 0 = len([])

tests\unit\test_repositories.py:382: AssertionError
=========================== short test summary info ===========================
FAILED tests/unit/test_repositories.py::test_interaction_repository_roundtrip_in_memory
======================== 1 failed, 12 passed in 3.39s =========================
